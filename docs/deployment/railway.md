# ğŸš‚ Deploy Backend to Railway

Deploy your Django backend to Railway with automatic deployments.

---

## Prerequisites

- GitHub account with your code pushed
- [Railway account](https://railway.app/) (free tier: $5 credit/month)

---

## Step 1: Prepare Your Code

### Update `requirements.txt`

Add these to `backend/requirements.txt`:

```
gunicorn==21.2.0
psycopg2-binary==2.9.9
whitenoise==6.6.0
dj-database-url==2.1.0
```

### Create `Procfile`

Create `backend/Procfile`:

```
web: gunicorn chatbot_project.wsgi --log-file -
release: python manage.py migrate
```

### Create `runtime.txt`

Create `backend/runtime.txt`:

```
python-3.11.0
```

### Update `settings.py`

Add to `backend/chatbot_project/settings.py`:

```python
import dj_database_url

# Static files with WhiteNoise
MIDDLEWARE.insert(1, 'whitenoise.middleware.WhiteNoiseMiddleware')
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'

# Database from URL (for Railway)
DATABASE_URL = os.getenv('DATABASE_URL')
if DATABASE_URL:
    DATABASES['default'] = dj_database_url.config(
        default=DATABASE_URL,
        conn_max_age=600
    )

# Allowed hosts
ALLOWED_HOSTS = os.getenv('ALLOWED_HOSTS', 'localhost,127.0.0.1').split(',')

# Security for production
if not DEBUG:
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True
```

---

## Step 2: Create Railway Project

1. Go to [Railway Dashboard](https://railway.app/dashboard)
2. Click **New Project**
3. Select **Deploy from GitHub repo**
4. Choose your repository
5. Select the `backend` folder as root (if prompted)

---

## Step 3: Add PostgreSQL

1. In your Railway project, click **New**
2. Select **Database â†’ PostgreSQL**
3. Railway automatically sets `DATABASE_URL`

---

## Step 4: Set Environment Variables

1. Click on your web service
2. Go to **Variables** tab
3. Add:

| Variable         | Value                  |
| ---------------- | ---------------------- |
| `SECRET_KEY`     | (generate a new one)   |
| `GROQ_API_KEY`   | (your Groq API key)    |
| `ENCRYPTION_KEY` | (generate with Fernet) |
| `DEBUG`          | `False`                |
| `ALLOWED_HOSTS`  | `.railway.app`         |
| `PORT`           | `8000`                 |

> ğŸ’¡ `DATABASE_URL` is auto-generated by Railway

---

## Step 5: Configure Build

1. Go to **Settings** tab
2. Set:
   - **Root Directory**: `backend`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn chatbot_project.wsgi`

---

## Step 6: Deploy

Railway deploys automatically on push. Check the **Deployments** tab.

After deploy, run migrations:

1. Open **Railway CLI** or use the web terminal
2. Run:

```bash
python manage.py migrate
python manage.py createsuperuser
```

---

## Step 7: Get Your URL

1. Go to **Settings â†’ Networking**
2. Click **Generate Domain**
3. Your API is now at `https://your-app.railway.app/api/`

---

## Step 8: Update Frontend

Update `frontend/.env.local`:

```env
NEXT_PUBLIC_API_URL=https://your-app.railway.app/api/
```

---

## Troubleshooting

### Build fails

Check the **Deploy Logs** for specific errors

### "No module named 'gunicorn'"

Ensure `gunicorn` is in `requirements.txt`

### 500 errors

Check that all environment variables are set

### Static files 404

```bash
python manage.py collectstatic --no-input
```

---

## Cost

| Resource   | Free Tier          |
| ---------- | ------------------ |
| Execution  | $5 credit/month    |
| PostgreSQL | Included in credit |
| Storage    | 1GB                |

> ğŸ’¡ $5 credit is enough for small projects (~500 hours)
